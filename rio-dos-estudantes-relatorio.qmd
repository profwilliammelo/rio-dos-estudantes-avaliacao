---
title: "Oficina Rio dos Estudantes: um estudo longitudinal"
author: "William Melo"
date: today
format:
  html:
    toc: true
    css: styles.css
execute:
  echo: false
  warning: false
  message: false
embed-resources: true
lang: pt
---

::: {.cell}
::: {.cell-code}
```{css}
/* Estilo CSS para background rosa claro */
body {
  background-color: #ffe6e6;
}
```
:::
:::

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  fig.width  = 10,
  fig.height = 6,
  dev.args   = list(bg = "transparent") # fundo transparente para os graficos
)

```

# Resumo


A oficina **Rio dos Estudantes** foi avaliada antes e depois com o mesmo questionário aplicado a ≈120 alunos. Nas sete dimensões analisadas, o extremo “Muito Pouco” caiu 15 – 23 p.p. e “Pouco” subiu até 28 p.p., indicando migração do desconhecimento para curiosidade. “História do Bairro”, “História da Escola” e “História do Rio” apresentaram os maiores ganhos agregados, enquanto “Importância da História” e “Representatividade em Livros” revelaram revisões críticas (queda em “Muito”). Nas trajetórias individuais, 31 – 39 % melhoraram ao menos um ponto nas dimensões locais e 11 – 30 % pioraram, com retrocesso mais alto em Importância da História (30 %) e Representatividade nos Livros (24 %). No pós-teste, 82 % consideraram as oficinas importantes para conhecer o bairro, 66 % para contar histórias e 58 % para sentir-se representados, sem grandes disparidades de gênero ou raça. Ganhos mostram que as oficinas estão no caminho do que se propõem; recomendam-se produtos narrativos públicos para avançar de categorias “Bem” a “Muito” em termos de percepção. Regressos em História do Rio pedem conteúdo modularizado e quizzes de fixação. A queda crítica em percepção de Importância da História sugere projetos de aplicação comunitária para validar o conhecimento histórico. Percepções polarizadas sobre representatividade nos livros exigem expansão imediata do acervo com vozes diversas. Consolidar avanços e atacar retrocessos por dimensão tornará a curiosidade despertada um domínio histórico mais duradouro.


# Introdução

A oficina **Rio dos Estudantes** busca despertar o interesse dos(as) alunos(as) pela história do Rio de Janeiro, conectando memórias do bairro, da escola e da cidade. Para avaliar como variam as percepções de alunos participantes antes e depois das oficinas, aplicamos o mesmo questionário **no início** e **no final** da oficina (119 – 122 respostas por item).

# Metodologia

### Desenho do estudo

Foi conduzido um **estudo de coorte longitudinal** junto a estudantes de 6 escolas públicas do Rio de Janeiro que participaram da oficina *Rio dos Estudantes — 2023.1*. O mesmo questionário foi aplicado **antes** (N = 682) e **após** (N = 140) a intervenção. O pareamento exato de registros por *nome do estudante* e *escola* resultou em uma coorte emparelhada de **122 alunos** respondentes nos dois momentos, que constitui a base de análise de variação.


### Instrumento

O questionário incluiu:

1. **Dados sociodemográficos** – idade, bairro, cor/raça, identidade de gênero, escolaridade dos responsáveis, entre outros.
2. **Sete escalas Likert (1 = “muito pouco” → 4 = “muito”)** sobre conhecimento histórico e percepção de representatividade (@tbl-variaveis).
3. **Três questões de percepção de impacto** das oficinas (itens 18–20) aplicadas apenas no pós-teste.

### Esquema do desenho do estudo

```{mermaid}
%%| label: fig-esquema-estudo
%%| fig-cap: "Desenho longitudinal da avaliação (antes × depois)"
flowchart TD
  A["Pré-teste\n(N = 682)"] -->|Oficina| B["Pós-teste\n(N = 140)"]
  A & B -->|Pareamento| C["Cohorte emparelhada\n(N = 122)"]
  C --> D{Análises}
  D --> D1["Variação\npercentual\n(Antes × Depois)"]
  D --> D2["Trajetória\nindividual"]
  D --> D3["Percepção\nde impacto"]


```


### Variáveis utilizadas

```{r}
#| label: tbl-variaveis
#| tbl-cap: "Variáveis originais e derivadas utilizadas na análise"
library(tibble)
library(knitr)

variaveis <- tribble(
  ~ `Variável original`,
  ~ Momento,
  ~ Tipo,
  ~ `Descrição utilizada na análise`,
  "conhecimento_bairro",
  "Antes/Depois",
  "Likert 1–4",
  "História do Bairro",
  "capacidade_contar_historias_bairro",
  "Antes/Depois",
  "Likert 1–4",
  "Contar História do Bairro",
  "conhecimento_rio",
  "Antes/Depois",
  "Likert 1–4",
  "História do Rio",
  "capacidade_contar_historias_cidade",
  "Antes/Depois",
  "Likert 1–4",
  "Contar História do Rio",
  "importancia_historia",
  "Antes/Depois",
  "Likert 1–4",
  "Importância da História",
  "representatividade_livros",
  "Antes/Depois",
  "Likert 1–4",
  "Representatividade em Livros",
  "conhecimento_escola",
  "Antes/Depois",
  "Likert 1–4",
  "História da Escola",
  "percepcao_riomemorias_bairro",
  "Depois",
  "Likert 1–4",
  "Conhecer a história do bairro",
  "percepcao_riomemorias_contarhistorias_bairro",
  "Depois",
  "Likert 1–4",
  "Contar histórias do bairro",
  "percepcao_riomemorias_representatividade_historia",
  "Depois",
  "Likert 1–4",
  "Sentir-se representado na história",
  "cor",
  "Antes/Depois",
  "Categórica",
  "Cor/raça do estudante",
  "genero",
  "Antes/Depois",
  "Categórica",
  "Identidade de gênero"
)

kable(variaveis, align = "l")

```


### Preparação dos dados

* **Limpeza**: remoção de duplicatas.
* **Transformação**: reorganização dos dados em formato longo, separando o conteúdo da variável do momento de aplicação (pré/pós).
* **Recodificação**: criação de rótulos descritivos para cada escala e de uma variável categórica com as quatro opções da Likert.

### Indicadores analíticos

1. **Variação média (pré × pós)** – cálculo do percentual de respostas em cada ponto da escala para as sete dimensões.
2. **Trajetória individual** – classificação de cada aluno-dimensão em *Melhorou*, *Piorou* ou *Permaneceu* conforme a diferença de escore entre os dois momentos.
3. **Percepção de impacto** – distribuição de importância atribuída às oficinas, por gênero e por cor/raça.

### Análises estatísticas

As comparações percentuais foram apresentadas em gráficos de barras e em quadros resumen; A produção de visualizações e cálculos foi realizada em **R (versão 4.2)**; a documentação e reprodutibilidade ficaram asseguradas pelo uso de **Quarto**.


```{r}
# Carrega pacotes essenciais
library(tidyverse)      # inclui dplyr, tidyr, ggplot2, etc.
library(gtsummary)      # para sumarização elegante (não usado neste trecho)
library(stringr)        # manipulação de strings
library(modelsummary)   # sumarização de modelos (não usado neste trecho)
library(purrr)          # programação funcional

# 1. Leitura dos dados iniciais e finais, padronização e remoção de duplicatas
#    - read.csv(): lê arquivos CSV separados por ";".
#    - mutate(): coloca nome_estudante e escola em minúsculas para uniformizar.
#    - distinct(): elimina registros duplicados mantendo apenas a primeira ocorrência.
inicio <- read.csv("inicial_2023_1.csv", sep = ";") %>%
  mutate(
    nome_estudante = tolower(nome_estudante),
    escola         = tolower(escola)
  ) %>%
  distinct(nome_estudante, escola, .keep_all = TRUE)

final <- read.csv("final_2023_1.csv", sep = ";") %>%
  mutate(
    nome_estudante = tolower(nome_estudante),
    escola         = tolower(escola)
  ) %>%
  distinct(nome_estudante, escola, .keep_all = TRUE)

# 2. Junção dos dois datasets (antes e depois)
#    - inner_join() garante que só ficamos com alunos presentes em ambos os arquivos.
#    - suffix adiciona "_antes" e "_depois" às colunas sobrepostas.
antes_depois <- inner_join(
  inicio, final,
  by     = c("nome_estudante", "escola"),
  suffix = c("_antes", "_depois")
)

# 3. Transformação de formato wide para long
#    - pivot_longer(): reúne colunas de perguntas antes/depois em duas novas colunas:
#        * variavel: o nome da pergunta (antes de "_antes"/"_depois")
#        * periodo : "antes" ou "depois"
#        * valor   : valor original da resposta (1–4)
dados_longos <- antes_depois %>%
  pivot_longer(
    cols        = c(
      conhecimento_bairro_antes,  conhecimento_bairro_depois,
      capacidade_contar_historias_bairro_antes, capacidade_contar_historias_bairro_depois,
      conhecimento_rio_antes,     conhecimento_rio_depois,
      capacidade_contar_historias_cidade_antes, capacidade_contar_historias_cidade_depois,
      importancia_historia_antes,  importancia_historia_depois,
      representatividade_livros_antes, representatividade_livros_depois,
      conhecimento_escola_antes,   conhecimento_escola_depois
    ),
    names_to    = c("variavel", "periodo"),
    names_pattern = "(.*)_(antes|depois)",
    values_to   = "valor"
  ) %>%
  # Converte a coluna 'periodo' em fator ordenado (Antes, Depois)
  mutate(
    periodo = factor(periodo, 
                     levels = c("antes", "depois"),
                     labels = c("Antes", "Depois"))
  )

# 4. Filtragem de valores válidos e criação do fator Likert
#    - filter(): mantém somente valores entre 1 e 4
#    - mutate(): cria resposta_likert com labels descritivos
dados_likert <- dados_longos %>%
  filter(valor %in% 1:4) %>%
  mutate(
    resposta_likert = factor(
      valor,
      levels = 1:4,
      labels = c("Muito Pouco", "Pouco", "Bem", "Muito")
    )
  )

# 5. Rotulagem das variáveis em termos descritivos
#    - case_when(): mapeia códigos de variavel para nomes mais amigáveis
dados_likert <- dados_likert %>%
  mutate(
    var_rotulo = case_when(
      variavel == "conhecimento_bairro"                 ~ "História do Bairro",
      variavel == "capacidade_contar_historias_bairro" ~ "Contar História do Bairro",
      variavel == "conhecimento_rio"                    ~ "História do Rio",
      variavel == "capacidade_contar_historias_cidade"  ~ "Contar História do Rio",
      variavel == "importancia_historia"                ~ "Importância da História",
      variavel == "representatividade_livros"           ~ "Representatividade em Livros",
      variavel == "conhecimento_escola"                 ~ "História da Escola",
      TRUE                                              ~ variavel
    )
  )

# Ao final deste bloco, temos:
# - 'dados_likert': um tibble em formato longo
# - colunas:
#     nome_estudante, escola, variavel, periodo (Antes/Depois),
#     valor (1–4), resposta_likert (categorias descritivas),
#     var_rotulo (nome legível da dimensão)

```

# Resultados

::: {.callout-note appearance="simple"}

## Como ler os próximos gráficos e tabelas

Este relatório explora a mudança de percepção dos alunos de duas formas:

1. **Variação agregada**  

   **A [@tbl-variacao]** e os *gráficos “Antes × Depois”* mostram, para cada dimensão, a distribuição percentual dos quatro pontos da escala Likert (“Muito Pouco” → “Muito”). Essas visualizações respondem:  
   > “Qual foi a fotografia da turma como um todo antes da oficina? E depois?”

2. **Trajetória individual**  
   Como acompanhamos os **mesmos estudantes** nos dois momentos, conseguimos classificar cada um em:  
   - **Melhorou** – marcou uma categoria mais alta depois;  
   - **Piorou** – marcou uma categoria mais baixa depois;  
   - **Permaneceu** – manteve exatamente a mesma categoria.  

   A tabela de variação e os gráficos de mudança que você verá após os painéis agregados indicam *quanto dos alunos participantes das oficinas*, em cada dimensão, efetivamente **progrediu**, **regrediu** ou **ficou igual**.

Em conjunto, essas duas perspectivas permitem responder tanto **“o que mudou na média da turma?”** quanto **“quantos alunos, de fato, subiram ou desceram na escala?”**. A leitura dos resultados deve considerar as duas camadas.

:::

```{r}
# 6. Agregar os dados para calcular percentuais
dados_percentuais <- dados_likert %>%
  group_by(var_rotulo, periodo, resposta_likert) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(var_rotulo, periodo) %>%
  mutate(total = sum(n), percentual = 100 * n / total) %>%
  ungroup()
```

## Variação das médias ANTES x DEPOIS

```{r tabela_variacao, echo=FALSE}
#| label: tbl-variacao
#| tbl-cap: "Variação de percentual (Depois – Antes) por item"

library(dplyr)
library(tidyr)
library(gt)

# 1. Calcular delta arredondado
delta_table <- dados_percentuais %>%
  select(var_rotulo, periodo, resposta_likert, percentual) %>%
  pivot_wider(names_from = periodo, values_from = percentual) %>%
  mutate(delta = round(Depois - Antes)) %>%
  select(var_rotulo, resposta_likert, delta) %>%
  pivot_wider(names_from = resposta_likert, values_from = delta) %>%
  mutate(across(
    c(`Muito Pouco`, Pouco, Bem, Muito),
    ~ sprintf("%+d p.p.", .)
  ))

# 2. Renderizar tabela com GT (fundo transparente)
delta_table %>%
  gt(rowname_col = "var_rotulo") %>%
  cols_label(
    `Muito Pouco` = "Δ Muito Pouco",
    Pouco          = "Δ Pouco",
    Bem            = "Δ Bem",
    Muito          = "Δ Muito"
  ) %>%
  tab_options(
    table.font.size                  = px(14),
    table.width                      = pct(80),
    data_row.padding                 = px(5),
    table.background.color           = "transparent",
    heading.background.color         = "transparent",
    column_labels.background.color   = "transparent",
    heading.border.bottom.color      = "transparent",
    column_labels.border.bottom.color= "transparent"
  ) %>%
  fmt_missing(columns = everything(), missing_text = "-")



```

```{r graficos_antes_depois, echo=FALSE}

library(dplyr)
library(tidyr)
library(ggplot2)

plot_dim <- function(dim_name) {
  dados_percentuais %>%
    filter(var_rotulo == dim_name) %>%
    ggplot(aes(x = periodo, y = percentual, fill = resposta_likert)) +
      # barras lado a lado
      geom_col(position = position_dodge(width = 0.9), colour = "black") +
      # rótulos centralizados verticalmente dentro de cada barra
      geom_label(aes(label = sprintf("%.1f%%", percentual)),
                 position = position_dodge(width = 0.9),
                 vjust = 0.5,   # centraliza verticalmente
                 size = 3,
                 show.legend = FALSE) +
      scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20),
                         expand = expansion(mult = c(0, 0.05))) +
      labs(title = "", x = "Percentual (%)", y = NULL,
           fill = "Escala (1–4)") +
      theme_classic(base_size = 14) +
      theme(
        legend.position  = "bottom",
        axis.title.y     = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA),
        plot.background  = element_rect(fill = NA, colour = NA)
      )
}




```


### 1. Contar História do Bairro

```{r graf_contar_bairro}
#| label: fig-contar-bairro
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “Contar História do Bairro”"
#| fig-alt: "Gráfico de barras horizontal comparativo mostrando as porcentagens Antes e Depois para a dimensão Contar História do Bairro"
#| fig-width: 8
#| fig-height: 4

plot_dim("Contar História do Bairro")


```

::: {.callout-note appearance="simple"}

##### Leitura rápida – Contar História do Bairro

* **Muito Pouco:** 67 % → 44 % (−23 p.p.)
* **Pouco:** 16 % → 34 % (+18 p.p.)
* **Bem:** 9.9 % → 18 % (+8.1 p.p.)
* **Muito:** 7.4 % → 3.3 % (−4.1 p.p.)
:::

### 2. Contar História do Rio

```{r graf_contar_rio}
#| label: fig-contar-historia-rio
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “Contar História do Rio”"
#| fig-alt: "Gráfico de barras horizontal comparativo mostrando as porcentagens Antes e Depois para a dimensão Contar História do Rio"
#| fig-width: 8
#| fig-height: 4

plot_dim("Contar História do Rio")

```

::: {.callout-note appearance="simple"}

#### Leitura rápida – Contar História do Rio

* **Muito Pouco:** 55 % → 40 % (−15 p.p.)
* **Pouco:** 21 % → 38 % (+17 p.p.)
* **Bem:** 19 % → 16 % (−3 p.p.)
* **Muito:** 5.0 % → 5.7 % (+0.7 p.p.)

:::

### 3. História da Escola

```{r graf_hist_escola}
#| label: fig-hist-escola
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “História da Escola”"
#| fig-alt: "Gráfico de barras horizontal comparativo mostrando as porcentagens Antes e Depois para a dimensão História da Escola"
#| fig-width: 8
#| fig-height: 4

plot_dim("História da Escola")

```

::: {.callout-note appearance="simple"}

##### Leitura rápida – História da Escola

* **Muito Pouco:** 54 % → 32 % (−22 p.p.)
* **Pouco:** 26 % → 46 % (+20 p.p.)
* **Bem:** 11 % → 17 % (+6 p.p.)
* **Muito:** 8.6 % → 4.9 % (−3.7 p.p.)

:::

### 4. História do Bairro

```{r graf_hist_bairro}
#| label: fig-hist-bairro
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “História do Bairro”"
#| fig-alt: "Gráfico de barras horizontal comparativo mostrando as porcentagens Antes e Depois para a dimensão História do Bairro"
#| fig-width: 8
#| fig-height: 4

plot_dim("História do Bairro")

```

::: {.callout-note appearance="simple"}

##### Leitura rápida – História do Bairro

* **Muito Pouco:** 54 % → 32 % (−22 p.p.)
* **Pouco:** 28 % → 43 % (+15 p.p.)
* **Bem:** 7.5 % → 16 % (+8.5 p.p.)
* **Muito:** 10 % → 9 % (−1 p.p.)

:::

### 5. História do Rio

```{r graf_hist_rio}
#| label: fig-hist-rio
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “História do Rio”"
#| fig-alt: "Gráfico de barras horizontal comparativo mostrando as porcentagens Antes e Depois para a dimensão História do Rio"
#| fig-width: 8
#| fig-height: 4

plot_dim("História do Rio")

```

::: {.callout-note appearance="simple"}

##### Leitura rápida – História do Rio

* **Muito Pouco:** 51 % → 29 % (−22 p.p.)
* **Pouco:** 21 % → 49 % (+28 p.p.)
* **Bem:** 15 % → 17 % (+2 p.p.)
* **Muito:** 12 % → 4.9 % (−7.1 p.p.)

:::

### 6. Importância da História

```{r graf_importancia}
#| label: fig-importancia-historia
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “Importância da História”"
#| fig-alt: "Gráfico de barras comparativo mostrando as porcentagens Antes e Depois para a dimensão Importância da História"
#| fig-width: 8
#| fig-height: 4

plot_dim("Importância da História")

```

::: {.callout-note appearance="simple"}

##### Leitura rápida – Importância da História

* **Muito Pouco:** 15 % → 8.2 % (−6.8 p.p.)
* **Pouco:** 6.7 % → 14 % (+7.3 p.p.)
* **Bem:** 29 % → 43 % (+14 p.p.)
* **Muito:** 49 % → 35 % (−14 p.p.)

:::

### 7. Representatividade em Livros

```{r graf_repr_livros}
#| label: fig-representatividade-livros
#| fig-cap: "Distribuição de respostas (Antes × Depois) para “Representatividade em Livros”"
#| fig-alt: "Gráfico de barras comparativo mostrando as porcentagens Antes e Depois para a dimensão Representatividade em Livros"
#| fig-width: 8
#| fig-height: 4

plot_dim("Representatividade em Livros")

```

::: {.callout-note appearance="simple"}

##### Leitura rápida – Representatividade em Livros

* **Muito Pouco:** 40 % → 21 % (−19 p.p.)
* **Pouco:** 29 % → 50 % (+21 p.p.)
* **Bem:** 16 % → 25 % (+9 p.p.)
* **Muito:** 14 % → 4.1 % (−9.9 p.p.)

:::

## Trajetória individual

Além de comparar, em termos agregados, o percentual de respostas em cada ponto da escala (**“Muito Pouco”, “Pouco”, “Bem”, “Muito”**) nos momentos **Antes** e **Depois**, o nosso desenho longitudinal — isto é, o fato de acompanharmos exatamente os mesmos estudantes nos dois períodos — permite ir além: conseguimos identificar, **aluno a aluno**, se houve **melhora** (marcou uma categoria mais alta), **piora** (categoria mais baixa) ou **manutenção** (categoria igual) em cada dimensão analisada.
Essa abordagem responde perguntas que a simples variação de percentuais não alcança, como:

* *Quantos* estudantes efetivamente progrediram em “Contar História do Bairro”?
* Qual a proporção de alunos que se manteve estável em “Importância da História”, indicando percepção já consolidada?

O bloco a seguir cria essa classificação (“Melhorou”, “Piorou”, “Permaneceu”) para cada aluno-dimensão, filtra apenas os casos com respostas completas nos dois momentos, mostra uma tabela com os alunos e suas respostas antes e depois e, por fim, apresenta uma tabela resumo com o número e o percentual de estudantes em cada situação nos dois momentos de pesquisa.


```{r trajetoria_individual}

library(dplyr)
library(tidyr)
library(knitr)

# 1. Preparar microdados e filtrar só quem respondeu antes e depois
microdados <- dados_likert %>%
  mutate(val = as.integer(resposta_likert)) %>%
  pivot_wider(
    id_cols     = c(nome_estudante, escola, var_rotulo),
    names_from  = periodo,
    values_from = val
  ) %>%
  # Filtra apenas registros com respostas em ambos os períodos
  filter(!is.na(Antes) & !is.na(Depois)) %>%
  # Classifica mudança explicitamente
  mutate(
    status = case_when(
      Depois > Antes  ~ "Melhorou",
      Depois < Antes  ~ "Piorou",
      Depois == Antes ~ "Permaneceu",
      TRUE             ~ NA_character_
    )
  ) %>%
  select(nome_estudante, escola, var_rotulo, Antes, Depois, status)

```

```{r tbl-microdados}
#| label: tbl-microdados
#| tbl-cap: "Microdados (todos os casos com respostas Antes e Depois)"
#| warning: false
#| message: false

library(DT)

DT::datatable(
  microdados,
  filter     = "top",                     # filtro por coluna
  extensions = "Buttons",                 # habilita botões
  options    = list(
    dom        = "Bfrtip",                # B=Buttons, f=filter, r=processing, t=table, i=info, p=pagination
    scrollX    = TRUE,                    # rolagem horizontal se necessário
    buttons    = list(                    # botões de exportação
      list(extend = "copy",  text = "Copiar"),
      list(extend = "csv",   text = "CSV"),
      list(extend = "excel", text = "Excel"),
      list(extend = "pdf",   text = "PDF"),
      list(extend = "print", text = "Imprimir")
    )
  )
) %>%
  formatStyle(
    columns  = names(microdados),
    fontSize = "90%"                       # fonte levemente menor
  )


```


```{r tbl-resumo-dim}
#| label: tbl-resumo-dim
#| tbl-cap: "Trajetórias individuais: número e percentual de alunos que melhoraram, permaneceram ou pioraram em cada dimensão"
#| warning: false
#| message: false

library(dplyr)
library(tidyr)
library(DT)

# 1. Constrói a tabela-resumo ordenando pelas maiores melhorias
resumo_dim <- microdados %>%
  group_by(var_rotulo, status) %>%
  summarise(contagem = n(), .groups = "drop") %>%
  group_by(var_rotulo) %>%
  mutate(
    total = sum(contagem),
    perc  = round(100 * contagem / total, 1)
  ) %>%
  ungroup() %>%
  pivot_wider(
    names_from  = status,
    values_from = c(contagem, perc),
    names_sep   = "_"
  ) %>%
  arrange(desc(perc_Melhorou), perc_Piorou) %>%    # ordena
  rename(
    Dimensão          = var_rotulo,
    `Melhorou (n)`    = contagem_Melhorou,
    `Permaneceu (n)`  = contagem_Permaneceu,
    `Piorou (n)`      = contagem_Piorou,
    `% Melhorou`      = perc_Melhorou,
    `% Permaneceu`    = perc_Permaneceu,
    `% Piorou`        = perc_Piorou
  )

# 2. Tabela interativa com filtros e botões de exportação
datatable(
  resumo_dim,
  filter     = "top",
  extensions = "Buttons",
  options    = list(
    dom      = "Bfrtip",
    buttons  = c("copy", "csv", "excel", "pdf", "print"),
    pageLength = nrow(resumo_dim),
    scrollX  = TRUE
  )
)


```


### Análise de percepções das oficinas

O bloco de *percepções* do **questionário final** (itens 18-20) avalia **o quão importantes** os(as) estudantes julgaram as oficinas do Rio Memórias em três aspectos:

| Nº | Pergunta (rótulo usado nos gráficos)                            | Foco da percepção                             |
| -- | --------------------------------------------------------------- | --------------------------------------------- |
| 18 | **“Conhecer melhor a história do bairro/território”**           | Ganho de **conhecimento** local               |
| 19 | **“Conseguir contar melhor a história do bairro/território”**   | Ganho de **habilidade narrativa**             |
| 20 | **“Sentir-se mais representado na história do Rio de Janeiro”** | Ganho de **pertencimento/representatividade** |

Para cada item, o(a) aluno(a) assinalou uma das quatro categorias de importância:

> 1 = Muito pouco·2 = Pouco·3 = Bem·4 = Muito

Como essas perguntas só existem **depois da oficina**, não há comparação Antes × Depois. Em vez disso, exploramos:

1. **Distribuição geral** – quão importante a turma, como um todo, considerou cada aspecto.
2. **Diferenças por gênero** – se meninas e meninos atribuem importância distinta.
3. **Diferenças por cor/raça** – possíveis variações de percepção entre grupos raciais.

Os gráficos a seguir mostram, para cada item, a percentagem em cada ponto da escala; etiquetas numéricas facilitam a leitura.



```{r percepcao_oficinas}
# 9.1 Selecionar variáveis que começam com "percepcao_" e preparar base longa
variaveis_percepcao <- final %>%
  select(starts_with("percepcao_")) %>%
  names()

dados_percepcao <- final %>%
  select(all_of(c("genero", "cor", variaveis_percepcao))) %>%
  pivot_longer(
    cols = all_of(variaveis_percepcao),
    names_to = "variavel",
    values_to = "resposta"
  ) %>%
  filter(resposta %in% 1:4) %>%
  mutate(
    resposta_likert = factor(resposta, levels = 1:4,
                             labels = c("Muito pouco", "Pouco", "Bem", "Muito")),
    var_rotulo = case_when(
      variavel == "percepcao_riomemorias_bairro" ~ "Conhecer a história do bairro",
      variavel == "percepcao_riomemorias_contarhistorias_bairro" ~ "Contar histórias do bairro",
      variavel == "percepcao_riomemorias_representatividade_historia" ~ "Sentir-se representado na história",
      TRUE ~ variavel
    )
  )
```

```{r graficos_percepcao}
#| label: fig-percepcao-geral
#| fig-cap: "Percepção das oficinas do Rio Memórias (geral)"
#| fig-alt: "Gráfico facetado de barras horizontais mostrando distribuição percentual das respostas 'Muito pouco' a 'Muito' para cada dimensão de percepção, no questionário final."
#| fig-width: 10
#| fig-height: 8

### Gráfico Geral das Percepções

grafico_geral <- dados_percepcao %>%
  group_by(var_rotulo, resposta_likert) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(var_rotulo) %>%
  mutate(percentual = 100 * n / sum(n)) %>%
  ggplot(aes(x = resposta_likert, y = percentual, fill = resposta_likert)) +
    geom_col(color = "black") +
    geom_label(aes(label = paste0(round(percentual, 1), "%")), 
               hjust = -0.1, show.legend = FALSE) +
    facet_wrap(~ var_rotulo, scales = "free_y", ncol = 1) +
    scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.05))) +
    labs(x = "Percentual (%)", y = NULL, fill = "Resposta") +
    theme_classic(base_size = 13) +
    theme(legend.position = "none",
          plot.margin = unit(c(1,1,1,1), "cm")) +
    coord_flip() +
    theme(panel.background = element_rect(fill = NA, color = NA),
          plot.background  = element_rect(fill = NA, color = NA))

print(grafico_geral)

```

```{r percepcao_genero}
#| label: fig-percepcao-genero
#| fig-cap: "Distribuição das percepções das oficinas por gênero"
#| fig-alt: "Gráficos de barras horizontais comparando, para cada dimensão de percepção, o percentual de respostas em cada categoria por gênero."
#| fig-width: 10
#| fig-height: 12

library(purrr)
dimensoes <- unique(dados_percepcao$var_rotulo)

walk(dimensoes, function(dim) {
  dados_percepcao %>%
    filter(var_rotulo == dim) %>%
    group_by(resposta_likert, genero) %>%
    summarise(n = n(), .groups = "drop") %>%
    mutate(percentual = 100 * n / sum(n)) %>%
    ggplot(aes(x = resposta_likert, y = percentual, fill = genero)) +
      geom_col(position = position_dodge(width = 0.8), color = "black") +
      geom_label(aes(label = paste0(round(percentual,1), "%")),
                 position = position_dodge(width = 0.8),
                 hjust = -0.1, show.legend = FALSE) +
      labs(
        title = dim,
        x     = "Percentual (%)",
        y     = NULL,
        fill  = "Gênero"
      ) +
      theme_classic(base_size = 14) +
      theme(
        legend.position = "bottom",
        plot.margin     = unit(c(0.5,0.5,0.5,0.5), "cm"),
        axis.title.y    = element_blank(),
        axis.text.y     = element_text(size = 12),
        panel.background = element_rect(fill = NA, color = NA),
        plot.background  = element_rect(fill = NA, color = NA)
      ) +
      coord_flip() ->
    p
  
  print(p)
})


```

### Percepção por Raça/Cor

```{r percepcao_raca}
#| label: fig-percepcao-raca
#| fig-cap: "Distribuição das percepções das oficinas por raça/cor"
#| fig-alt: "Gráficos de barras horizontais comparando, para cada dimensão de percepção, o percentual de respostas em cada categoria por raça/cor."
#| fig-width: 10
#| fig-height: 12

library(purrr)
dimensoes <- unique(dados_percepcao$var_rotulo)

walk(dimensoes, function(dim) {
  dados_percepcao %>%
    filter(var_rotulo == dim) %>%
    group_by(resposta_likert, cor) %>%
    summarise(n = n(), .groups = "drop") %>%
    mutate(percentual = 100 * n / sum(n)) %>%
    ggplot(aes(x = resposta_likert, y = percentual, fill = cor)) +
      geom_col(position = position_dodge(width = 0.8), color = "black") +
      geom_label(aes(label = paste0(round(percentual,1), "%")),
                 position = position_dodge(width = 0.8),
                 hjust = -0.1, show.legend = FALSE) +
      labs(
        title = dim,
        x     = "Percentual (%)",
        y     = NULL,
        fill  = "Raça/Cor"
      ) +
      theme_classic(base_size = 14) +
      theme(
        legend.position = "bottom",
        plot.margin     = unit(c(0.5,0.5,0.5,0.5),"cm"),
        axis.title.y    = element_blank(),
        axis.text.y     = element_text(size = 12),
        panel.background = element_rect(fill = NA, color = NA),
        plot.background  = element_rect(fill = NA, color = NA)
      ) +
      coord_flip() ->
    p

  print(p)
})


```


Nos sete eixos avaliados antes e depois da oficina, o retrato agregado mostra o mesmo padrão: **forte retração no extremo “Muito Pouco” (-7 a -23 p.p.) acompanhada de expansão nas categorias intermediárias**. Em “Contar História do Bairro”, por exemplo, o desconhecimento declarado caiu 23 p.p. enquanto as respostas “Pouco” (+18 p.p.) e “Bem” (+8 p.p.) quase dobraram. Tendência semelhante surgiu em “História da Escola” (-22 / +20 / +6 p.p.) e “História do Rio” (-23 / +28 / +2 p.p.). Já em “Importância da História” — dimensão que partia de níveis altos — parte dos alunos desceu de “Muito” para “Bem” (-14 p.p.), sugerindo uma visão mais crítica, não perda de relevância. Em “Representatividade em Livros”, a queda de 10 p.p. em “Muito” combinada ao aumento de 21 p.p. em “Pouco” indica maior consciência de lacunas no acervo.


Quanto Às **Trajetórias individuais (melhora / piora / manutenção)**, a leitura caso-a-caso confirma uma variação não homgênea nos itens:

* **Contar História do Bairro** – 35 % dos(as) estudantes subiram pelo menos um ponto na escala, 51 % permaneceram e 13 % regrediram. O quadro sugere progresso sólido, mas ainda há um grupo (≈1 em 8) que perdeu confiança; sessões de prática oral podem apoiar esse segmento.

* **Contar História do Rio** – 33 % avançaram, 49 % ficaram estáveis e 18 % voltaram atrás. O tema despertou curiosidade geral, mas quase um quinto da turma sofreu regressão; incorporar quizzes periódicos e mapas interativos ajudará a fixar conteúdo e reduzir as quedas.

* **História da Escola** – A maior taxa de melhoria (37 %) e apenas 14 % de retrocesso indicam que trabalhar com documentos e fotografias do próprio colégio foi especialmente mobilizador. Consolidar esse ganho exige dar visibilidade pública às narrativas produzidas (exposição permanente ou site da escola).

* **História do Bairro** – 39 % melhoraram, 50 % se mantiveram e apenas 11 % pioraram: a dimensão com o menor percentual de retrocesso. Roteiros guiados elaborados pelos alunos podem converter a metade estável em avanços adicionais.

* **História do Rio** – Apesar de 31 % de melhora, esta dimensão apresentou o segundo maior índice de piora (19 %). A amplitude cronológica e a complexidade dos eventos exigem uma sequência didática mais longa; sugerimos dividir o conteúdo em módulos temáticos curtos.

* **Importância da História** – Somente 19 % de progresso e o maior retrocesso (30 %). Ao refletirem mais criticamente, alguns estudantes reavaliaram a relevância da disciplina. Transformar esse ceticismo em engajamento pede projetos de aplicação concreta do conhecimento histórico na comunidade (por exemplo, campanhas de memória local).

* **Representatividade em Livros** – 35 % melhoraram, porém 24 % pioraram e 41 % ficaram iguais. O crescimento simultâneo de avanço e retrocesso mostra uma conscientização desigual: enquanto parte percebe mais vozes presentes, outra nota lacunas que antes ignorava. A resposta é expandir rapidamente o acervo com autores negros, indígenas e periféricos e envolver os estudantes na curadoria.

Em síntese, **um terço a dois quintos da turma progrediu na maioria das dimensões**, mas os índices de retrocesso variam de 11 % a 30 %. As próximas intervenções devem, portanto, ser calibradas **por dimensão**, priorizando reforço onde o percentual de piora foi mais alto e consolidando o que já avançou.


No bloco de **percepção de impacto** — aplicado apenas no pós-teste — a maioria dos alunos avaliou as oficinas como relevantes:

* **Conhecer a história do bairro**: 82 % marcaram “Bem” ou “Muito”.
* **Contar histórias do bairro**: 66 % em “Bem/Muito”.
* **Sentir-se representado na história do Rio**: 58 % em “Bem/Muito”, porém 42 % ainda entre “Pouco” e “Muito pouco”, reforçando a demanda por maior diversidade de vozes.

Diferenças por gênero e cor/raça oscilaram dentro de ±8 p.p., sem um grupo sistematicamente desfavorecido, mas merecem monitoração em futuras edições.

---


## Discussão

### 1. Variação das médias da turma (Antes × Depois)

A comparação agregada revela um **padrão consistente** em todas as sete dimensões:

* queda pronunciada nas respostas **“Muito Pouco”** (-15 a -23 p.p.);
* crescimento nas categorias intermediárias — sobretudo **“Pouco”** (+7 a +28 p.p.) e, em menor grau, **“Bem”** (+2 a +14 p.p.);
* leve retração ou estabilidade em **“Muito”** (-1 a -14 p.p.).

Em termos práticos, isso significa que a oficina **deslocou boa parte da turma do desconhecimento total para um estágio de curiosidade ou compreensão inicial**. Os casos mais expressivos foram:

* **História do Rio** – redução de 23 p.p. em “Muito Pouco” e aumento recorde de 28 p.p. em “Pouco”; sinal de que a temática despertou interesse, mas ainda não gerou domínio sólido.
* **Contar/História do Bairro** e **História da Escola** – quedas de 22–23 p.p. em “Muito Pouco” com ganhos simultâneos de 15–20 p.p. em “Pouco” e \~8 p.p. em “Bem”; indicam que trabalhar com fontes locais é altamente mobilizador.
* **Importância da História** – partindo de base elevada, parte dos alunos recuou de “Muito” para “Bem” (-14 p.p.), sugerindo **amadurecimento crítico** mais do que desinteresse.
* **Representatividade em Livros** – queda de 10 p.p. em “Muito” e salto de 21 p.p. em “Pouco”: os alunos passaram a notar lacunas de vozes diversas no acervo.

### 2. Trajetórias individuais (Melhorou / Permaneceu / Piorou)

Quando observamos cada estudante pareado antes–depois, o panorama se nuança:

| Dimensão                     | % Melhorou | % Permaneceu | % Piorou | Leitura                                               |
| ---------------------------- | ---------- | ------------ | -------- | ----------------------------------------------------- |
| Contar História do Bairro    | **36 %**   | 51 %         | 13 %     | Avanço sólido; baixa regressão.                       |
| Contar História do Rio       | **33 %**   | 49 %         | 18 %     | Interesse acordou, mas 1/5 perdeu confiança.          |
| História da Escola           | **37 %**   | 49 %         | 14 %     | Progresso; explorar mais histórias escolares.    |
| História do Bairro           | **39 %**   | 50 %         | **11 %** | Menor retrocesso.         |
| História do Rio              | **31 %**   | 50 %         | **19 %** | Tema complexo; precisa reforço modular.          |
| Importância da História      | 19 %       | 50 %         | **30 %** | Reflexão crítica levou parte a reavaliar importância. |
| Representatividade em Livros | 35 %       | 41 %         | **24 %** | Conscientização desigual sobre lacunas do acervo da escola.     |

* **Ganhos** (≈ 31–39 % de melhoria) apareceram nas cinco dimensões de história local; regressos mantiveram-se abaixo de 20 %.
* **Representatividade em Livros** e **Importância da História** exibem os maiores percentuais de piora (≥ 24 %). Em **Representatividade em Livros**, a coexistência de 35 % que melhorou e 24 % que piorou indica **percepções polarizadas**: à medida que alguns enxergam avanços, outros passam a notar ausências — exigindo trabalho focado em bibliograficas que egerem representatividade.

## Conclusão

O estudo longitudinal demonstra que a oficina **cumpriu o papel de romper a barreira do desconhecimento**: agregadamente, “Muito Pouco” cedeu espaço a “Pouco” e “Bem” em todas as dimensões, e de 31 % a 39 % dos estudantes subiram pelo menos um degrau na escala. Contudo, entre 11 % e 30 % regrediram, variando conforme o tema.

As evidências sugerem dois caminhos complementares:

1. **Consolidar avanços locais** – manter investigações de bairro e escola, agora convertendo relatos em produtos públicos (podcasts, roteiros guiados) para levar quem está em “Bem” a “Muito”.
2. **Atacar pontos de maior retrocesso** – modular o conteúdo de História do Rio, criar quizzes de fixação, promover projetos de aplicação comunitária para reafirmar a importância da disciplina, e trabalhar com um acervo diversificado (ou estimular seu uso) para responder à percepção crítica de representatividade nos livros.

Com intervenções direcionadas por dimensão e acompanhamento periódico das trajetórias individuais, o programa tende a transformar a curiosidade despertada em **domínio pleno e senso de pertencimento histórico** entre os jovens participantes.
